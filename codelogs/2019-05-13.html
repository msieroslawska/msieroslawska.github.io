<!DOCTYPE html><html lang="en"><head><link href="https://fonts.googleapis.com/css?family=DM+Sans:400,400i,700&amp;display=swap" rel="stylesheet"/><link href="https://fonts.googleapis.com/css?family=Space+Mono:400,400i,700&amp;display=swap" rel="stylesheet"/><title>2019-05-13</title><meta charSet="utf-8"/><meta name="viewport" content="initial-scale=1.0, width=device-width"/><meta name="next-head-count" content="3"/><link rel="preload" href="/_next/static/css/0fcb03e38cacf77fc9b1.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0fcb03e38cacf77fc9b1.css"/><link rel="preload" href="/_next/static/s7iXAZyb5Ha2u2j1r_k5s/pages/_app.js" as="script"/><link rel="preload" href="/_next/static/s7iXAZyb5Ha2u2j1r_k5s/pages/codelogs/%5Bslug%5D.js" as="script"/><link rel="preload" href="/_next/static/runtime/webpack-c212667a5f965e81e004.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.e84fa698c7ee940652bd.js" as="script"/><link rel="preload" href="/_next/static/chunks/commons.34684228d50c6c140f9e.js" as="script"/><link rel="preload" href="/_next/static/runtime/main-d8f6cc11b1d0cf8a72db.js" as="script"/><link rel="preload" href="/_next/static/chunks/027ef1e68a8faeecdab18641e53b6a91610e6293.0edb937e2e191f7bf5bd.js" as="script"/></head><body><div id="__next"><div><section class="page-wrapper"><section class="sidebar"><nav class="nav"><div class="nav-link "><a>Home</a></div><div class="nav-link "><a>About</a></div><div class="nav-link "><a>Blog</a></div><div class="nav-link "><a>Codelogs</a></div><div class="nav-link "><a>Articles</a></div><div class="nav-link "><a>Projects</a></div><div class="nav-link "><a>TODO</a></div></nav><footer class="footer"><p>Powered by <a href="https://nextjs.org/">next.js</a> and <a href="https://pages.github.com/">Github Pages</a></p></footer></section><main class="page-section"><h1 class="page-header">2019-05-13</h1><p>Tags: react,testing,devtools</p><section><h2>Plan for the day</h2>
<ul class="contains-task-list">
<li class="task-list-item"><input type="checkbox" checked disabled> Reanimate tests in my React calc app.</li>
<li class="task-list-item"><input type="checkbox" disabled> Cover UI with tests (<em>in progress</em>)!</li>
<li class="task-list-item"><input type="checkbox" checked disabled> Finish watching - <a href="https://frontendmasters.com/courses/chrome-dev-tools-v2/">Mastering Chrome Developer Tools, v2</a> by Jon Kuperman.</li>
</ul>
<h2>Learned today</h2>
<ul>
<li>It was easier to create a new <code>create-react-app</code> project from scratch than to figure out what to add to have running tests (note to self: don't try to be smart with "I'll add it later by myself" attitude and just keep stuff you know you will need later like, you know, tests!). I kept my components and styling. It was as easy as copying few files and re-installing some dependencies.</li>
<li>Even though I work with React almost on a daily basis, I've never set up tests by myself. It's really interesting to see how it works from scratch!</li>
</ul>
<h3>Snapshot testing</h3>
<p>Testing React involves UI which should stay stable and not change unexpetedly. Snapshot tests render a component and compare its state with a reference snapshot stored with the test.</p>
<p><strong>Jest</strong> allows you to render and test separate components, without the need to build and render the whole app UI.</p>
<ul>
<li>
<p>I got my first tests running!!</p>
<p><img src="/img/codelogs/first-jest-tests.png" alt="First Jest tests"></p>
<p>Now I <em>only</em> need to figure out how exactly Jest knows when tests are okay, but it's the snapshot what should be updated...</p>
</li>
</ul>
<h3>[Chrome DevTools] Page Jank</h3>
<p>It's jittering / jumping happening on websites, where a smooth scrolling would be expected. Obviously a bug.</p>
<p>Possible reasons:</p>
<ul>
<li>
<p>JS being too heavy</p>
<p>Smooth scrolling is defined at 60 frames / s, as the refresh rate on most devices nowadays. The browser needs to come up with a new picture (frame) for each of those refreshes. If it fails (because for example, it's busy trying to process bloated JS), we do not see smooth animation anymore.</p>
</li>
<li>
<p>Page trashing</p>
<p>Constantly modifying DOM (reading / writing) triggers the browser to keep refreshing the layout. Ideally instead of doing it in multiple read / write cycles, it's better to group similar actions together in batches for fewer layout refreshes. This, however, is rarely achievable.</p>
<p>Solutions:</p>
<ul>
<li><code>window.requestAnimationFrame()</code> asks the browser to do some computation before next frame,</li>
<li><code>FastDOM</code> library provides callbacks on read and write.</li>
</ul>
</li>
</ul>
<h3>[Chrome DevTools] Memory</h3>
<p>Garbage collector removes objects which are flagged as unused and no longer referenced. Sometimes though it is not possible to apply the flag (memory keeps being used) and this might be the cause of memory leaks.</p>
<p>Possible reasons:</p>
<ul>
<li>
<p>global variables (are you sure it has to be a global?),</p>
</li>
<li>
<p>forgotten timers and intervals,</p>
</li>
<li>
<p>variables which hold references to DOM objects which no longer exist (e.g. were deleted),</p>
</li>
<li>
<p><em>Performance</em> tab in DevTools helps you detect memory leaks while <em>Memory</em> tab shows you the exact reason(s).</p>
</li>
<li>
<p>When recording a performance session for memory, you'd want to make it slightly <strong>longer</strong> (to build up memory consumption data) than in case of CPU performance tests.</p>
</li>
</ul>
<h4>Task manager in Chrome</h4>
<ul>
<li>Accessible via <em>Three dots menu</em> > <em>More tools</em> > <em>Task manager</em></li>
<li>Monitors performance of each Chrome tab</li>
<li>Right-click on column names to access more data, e.g. <em>JavaScript memory</em></li>
</ul>
<h4>Memory profiles</h4>
<ul>
<li>Heap snapshot: shows everything that's being used. Can be run multiple times to get results to be compared.</li>
<li>Allocation instrumentation on timeline: like multimple heap snapshots, takes a lot of time.</li>
<li>Allocation sampling: takes different samples over long period of time.</li>
</ul>
<p><strong>Shallow size</strong>: how big are you?
Example: an array with 50 elements</p>
<p><strong>Retained size</strong>: how big are elements you're pointing at (how much memory can we free up if we get rid of you)?
Example: a variable pointing to an array with 1m elements</p>
<p>Aaaand that's how I have finished the "Mastering Chrome developer tools" class! Time for more!</p>
<h2>Resources list</h2>
<ul>
<li><a href="https://jestjs.io/docs/en/tutorial-react">Jest docs</a></li>
<li><a href="https://jestjs.io/docs/en/snapshot-testing">Jest snapshot testing</a></li>
<li><a href="https://medium.com/reloading/javascript-start-up-performance-69200f43b201">JS startup performance</a></li>
</ul>
<h2>Other resources</h2>
</section></main></section></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"codelog":{"tags":["react","testing","devtools"],"title":"2019-05-13","content":"\u003ch2\u003ePlan for the day\u003c/h2\u003e\n\u003cul class=\"contains-task-list\"\u003e\n\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" checked disabled\u003e Reanimate tests in my React calc app.\u003c/li\u003e\n\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" disabled\u003e Cover UI with tests (\u003cem\u003ein progress\u003c/em\u003e)!\u003c/li\u003e\n\u003cli class=\"task-list-item\"\u003e\u003cinput type=\"checkbox\" checked disabled\u003e Finish watching - \u003ca href=\"https://frontendmasters.com/courses/chrome-dev-tools-v2/\"\u003eMastering Chrome Developer Tools, v2\u003c/a\u003e by Jon Kuperman.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eLearned today\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eIt was easier to create a new \u003ccode\u003ecreate-react-app\u003c/code\u003e project from scratch than to figure out what to add to have running tests (note to self: don't try to be smart with \"I'll add it later by myself\" attitude and just keep stuff you know you will need later like, you know, tests!). I kept my components and styling. It was as easy as copying few files and re-installing some dependencies.\u003c/li\u003e\n\u003cli\u003eEven though I work with React almost on a daily basis, I've never set up tests by myself. It's really interesting to see how it works from scratch!\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003eSnapshot testing\u003c/h3\u003e\n\u003cp\u003eTesting React involves UI which should stay stable and not change unexpetedly. Snapshot tests render a component and compare its state with a reference snapshot stored with the test.\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eJest\u003c/strong\u003e allows you to render and test separate components, without the need to build and render the whole app UI.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eI got my first tests running!!\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/img/codelogs/first-jest-tests.png\" alt=\"First Jest tests\"\u003e\u003c/p\u003e\n\u003cp\u003eNow I \u003cem\u003eonly\u003c/em\u003e need to figure out how exactly Jest knows when tests are okay, but it's the snapshot what should be updated...\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e[Chrome DevTools] Page Jank\u003c/h3\u003e\n\u003cp\u003eIt's jittering / jumping happening on websites, where a smooth scrolling would be expected. Obviously a bug.\u003c/p\u003e\n\u003cp\u003ePossible reasons:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eJS being too heavy\u003c/p\u003e\n\u003cp\u003eSmooth scrolling is defined at 60 frames / s, as the refresh rate on most devices nowadays. The browser needs to come up with a new picture (frame) for each of those refreshes. If it fails (because for example, it's busy trying to process bloated JS), we do not see smooth animation anymore.\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003ePage trashing\u003c/p\u003e\n\u003cp\u003eConstantly modifying DOM (reading / writing) triggers the browser to keep refreshing the layout. Ideally instead of doing it in multiple read / write cycles, it's better to group similar actions together in batches for fewer layout refreshes. This, however, is rarely achievable.\u003c/p\u003e\n\u003cp\u003eSolutions:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003ewindow.requestAnimationFrame()\u003c/code\u003e asks the browser to do some computation before next frame,\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003eFastDOM\u003c/code\u003e library provides callbacks on read and write.\u003c/li\u003e\n\u003c/ul\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch3\u003e[Chrome DevTools] Memory\u003c/h3\u003e\n\u003cp\u003eGarbage collector removes objects which are flagged as unused and no longer referenced. Sometimes though it is not possible to apply the flag (memory keeps being used) and this might be the cause of memory leaks.\u003c/p\u003e\n\u003cp\u003ePossible reasons:\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\n\u003cp\u003eglobal variables (are you sure it has to be a global?),\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eforgotten timers and intervals,\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003evariables which hold references to DOM objects which no longer exist (e.g. were deleted),\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e\u003cem\u003ePerformance\u003c/em\u003e tab in DevTools helps you detect memory leaks while \u003cem\u003eMemory\u003c/em\u003e tab shows you the exact reason(s).\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003eWhen recording a performance session for memory, you'd want to make it slightly \u003cstrong\u003elonger\u003c/strong\u003e (to build up memory consumption data) than in case of CPU performance tests.\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003eTask manager in Chrome\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003eAccessible via \u003cem\u003eThree dots menu\u003c/em\u003e \u003e \u003cem\u003eMore tools\u003c/em\u003e \u003e \u003cem\u003eTask manager\u003c/em\u003e\u003c/li\u003e\n\u003cli\u003eMonitors performance of each Chrome tab\u003c/li\u003e\n\u003cli\u003eRight-click on column names to access more data, e.g. \u003cem\u003eJavaScript memory\u003c/em\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch4\u003eMemory profiles\u003c/h4\u003e\n\u003cul\u003e\n\u003cli\u003eHeap snapshot: shows everything that's being used. Can be run multiple times to get results to be compared.\u003c/li\u003e\n\u003cli\u003eAllocation instrumentation on timeline: like multimple heap snapshots, takes a lot of time.\u003c/li\u003e\n\u003cli\u003eAllocation sampling: takes different samples over long period of time.\u003c/li\u003e\n\u003c/ul\u003e\n\u003cp\u003e\u003cstrong\u003eShallow size\u003c/strong\u003e: how big are you?\nExample: an array with 50 elements\u003c/p\u003e\n\u003cp\u003e\u003cstrong\u003eRetained size\u003c/strong\u003e: how big are elements you're pointing at (how much memory can we free up if we get rid of you)?\nExample: a variable pointing to an array with 1m elements\u003c/p\u003e\n\u003cp\u003eAaaand that's how I have finished the \"Mastering Chrome developer tools\" class! Time for more!\u003c/p\u003e\n\u003ch2\u003eResources list\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ca href=\"https://jestjs.io/docs/en/tutorial-react\"\u003eJest docs\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://jestjs.io/docs/en/snapshot-testing\"\u003eJest snapshot testing\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003e\u003ca href=\"https://medium.com/reloading/javascript-start-up-performance-69200f43b201\"\u003eJS startup performance\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eOther resources\u003c/h2\u003e\n"}},"__N_SSG":true},"page":"/codelogs/[slug]","query":{"slug":"2019-05-13"},"buildId":"s7iXAZyb5Ha2u2j1r_k5s","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/runtime/polyfills-2f74f7d9820760171318.js"></script><script async="" data-next-page="/_app" src="/_next/static/s7iXAZyb5Ha2u2j1r_k5s/pages/_app.js"></script><script async="" data-next-page="/codelogs/[slug]" src="/_next/static/s7iXAZyb5Ha2u2j1r_k5s/pages/codelogs/%5Bslug%5D.js"></script><script src="/_next/static/runtime/webpack-c212667a5f965e81e004.js" async=""></script><script src="/_next/static/chunks/framework.e84fa698c7ee940652bd.js" async=""></script><script src="/_next/static/chunks/commons.34684228d50c6c140f9e.js" async=""></script><script src="/_next/static/runtime/main-d8f6cc11b1d0cf8a72db.js" async=""></script><script src="/_next/static/chunks/027ef1e68a8faeecdab18641e53b6a91610e6293.0edb937e2e191f7bf5bd.js" async=""></script><script src="/_next/static/s7iXAZyb5Ha2u2j1r_k5s/_buildManifest.js" async=""></script><script src="/_next/static/s7iXAZyb5Ha2u2j1r_k5s/_ssgManifest.js" async=""></script></body></html>