{"pageProps":{"blogs":[{"content":"\n## Jekyll\n\nWhen I initially decided to create a personal page, mostly to document my notes taken during my learning process, first and most popular result in the category of static page generators was Jekyll. I'm used to tinkering and tweaking and breaking the code, and in the end I got it running, but man, adjusting it to my needs was a real chore and the resulting mix of `md` and `html` was... an eyesore:\n\n```javascript\n---\n---\n\n/* eslint object-curly-newline: [\"error\", { \"multiline\": true }] */\n/* global document */\n\nlet postDay, postMonth, postYear;\nlet posts = [];\n\n{% for log in site.posts %}\n  postDay = \"{{ log.date | date: '%d' }}\";\n  postMonth = \"{{log.date | date: '%m'}}\"\n  postYear = \"{{log.date | date: '%Y'}}\"\n  posts.push(`${postYear}-${postMonth}-${postDay}`);\n{% endfor %}\n\nconst MONTHS = [\n  'December', 'November', 'October', 'September', 'August', 'July', 'June', 'May', 'April', 'March', 'February', 'January'];\n  // 'January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\n\nconst createUrl = ({ day, month, year }) => {\n  const url = document.createElement('a');\n  const urlText = document.createTextNode(day);\n  url.appendChild(urlText);\n  url.href = `{{ site.url }}/blog/codelogs/${year}-${month}-${day}-Codelog.html`;\n  return url;\n};\n\nconst createCell = ({\n  cellType = 'td',\n  className = '',\n  day = '',\n  isUrl = false,\n  month = '',\n  row,\n  text = '',\n  year = '',\n}) => {\n  const cell = document.createElement(cellType);\n\n  if (isUrl) {\n    cell.className = `${className} url`;\n    const url = createUrl({ className, day, month, year });\n    // url.className = 'url';\n    cell.appendChild(url);\n  } else {\n    cell.className = className;\n    const cellText = document.createTextNode(text);\n    cell.appendChild(cellText);\n  }\n\n  row.appendChild(cell);\n};\n\nconst getNumberOfDays = ({\n  month,\n  year = 2019\n}) => new Date(Number(year), Number(month) + 1, 0).getDate();\n\nconst createDayCell = ({ day, idx, row }) => {\n  const m = idx < 9 ? `0${idx + 1}` : `${idx + 1}`;\n  const d = day < 9 ? `0${day + 1}` : `${day + 1}`;\n  const isUrl = Boolean(posts.indexOf(`2019-${m}-${d}`) + 1);\n\n  createCell({ className: 'cell', day: d, isUrl, month: m, row, text: d, year: 2019 });\n};\n\nconst generateCalendar = () => {\n  const calendar = document.getElementById('calendar-table');\n  const currentDate = new Date();\n  let newRow;\n\n  MONTHS.forEach((monthName, i) => {\n    const idx = 11 - i;\n    if (currentDate.getMonth() >= Number(idx)) {\n      const monthHeader = document.createElement('h3');\n      monthHeader.className = 'month';\n      const monthText = document.createTextNode(monthName)\n      monthHeader.appendChild(monthText);\n      calendar.appendChild(monthHeader);\n      const monthTable = document.createElement('table');\n      calendar.appendChild(monthTable);\n\n      let isFirstDay = true;\n\n      console.log('day', currentDate.getDay())\n\n      for (const day of Array(getNumberOfDays({ month: idx })).keys()) {\n        if (isFirstDay || day % 7 === 0) {\n          newRow = document.createElement('tr');\n          newRow.className = 'row';\n\n          if (currentDate.getMonth() === Number(idx)) {\n            if (day < currentDate.getDay()) {\n              createDayCell({ day, idx, row: newRow });\n\n              monthTable.appendChild(newRow);\n              isFirstDay = false;\n            }\n          } else {\n            createDayCell({ day, idx, row: newRow });\n\n            monthTable.appendChild(newRow);\n            isFirstDay = false;\n          }\n        } else {\n          if (currentDate.getMonth() === Number(idx)) {\n            if (day < currentDate.getDay()) {\n              createDayCell({ day, idx, row: newRow });\n            }\n          } else {\n            createDayCell({ day, idx, row: newRow });\n          }\n        }\n      }\n    }\n  });\n};\n\ngenerateCalendar();\n```\n\nYeah... not the prettiest. In case you were wondering, this code was supposed to display a calendar with clickable cells on days when I posted something.\n\n## Gatsby\n\nThat's when I decided to move to a shinier engine, with something more modern. Yes! React! GraphQL! Yes! Yes!\n\n...but wait a moment.\n\nYes, that was an overkill. I grew impatient while debugging GraphQL queries and never finished porting the website.\n\n## Next.js\n\nFew months have passed. The idea of my poor, abandoned page covered in dust was like a thorn in my conscience, subtly poking me and reminding me of its existence. During these past months I got a new job, got comfortable with TypeScript working as a full-time dev, why not try again? Perhaps... something simple and yet customizable?\n\nThat's how I ended up with next.js.\n\nGetting familiar with the build system was a breeze. Integrating markdown files and processing was a bit of a chore, but still manageable. After a weekend, I had a nice, simple page running on my localhost. The time had come to **deploy**!\n\nUh oh. How do I deploy?\n\nOfficial docs recommend using Vercel. Ummmm, no. I haven't scratched my overcomplicated Gatsby approach only to make it tangled with 3rd party elements again.\n\nThere was plenty of tutorials how to deploy your **project page** under _xxxx.github.io/\\[project-name\\]_. But what about deploying to root directory of the domain, in order to deploy the website?\n\nI took me another few hours of poking and proding, lots of searching and reading stackoverflow. In the end, the solution which worked for me is the following:\n\n1. Two repositories\n\n- _main github.io repo_\n- _github.io-source_\n\n2. _github.io-source_ hosts the source code of next.js with a nice _deploy_ script in `package.json`:\n\n```javascript\nrm -rf out/ && next build && next export -o out && touch out/.nojekyll && cp -R out/ ../\\[main-repo-folder\\].github.io\n```\n\n3. _main github.io repo_ has **only** files generated by the deploy script -- `_next` folder and pure `html`. The only thing remaining after running deploy from source repo is to commit and push changes in the main repo.\n\nIt's not a perfect solution, yes. Are there better approaches? Perhaps. I was not able to find anything more elegant. Github pages are deploying the **personal page** (root domain) only from your _master_ branch (and root directory), therefore `html` has to sit directly at root and I didn't want to have my source polluted by it.\n","date":"2020-07-20","tags":["next.js"],"title":"How on Earth do I deploy next.js to github pages...?","slug":"2020-07-20"}]},"__N_SSG":true}